<%

var FLAG_PATTERN = /^(Breaking|Build|Chore|Docs|Fix|New|Update|Upgrade):/,
    ISSUE_REF_PATTERN = /\((fixes|refs) #\d+.*?\)$/;

function isValidCommitFlag(log) {
    var result = log.match(FLAG_PATTERN);
    return !!result || log.indexOf("Revert \"") === 0;
}

var problems = [];

if (!isValidCommitFlag(payload.pull_request.title)) {
    problems.push("The pull request title needs to begin with a tag (such as `Fix:` or `Update:`). Please check out our [guide](http://eslint.org/docs/developer-guide/contributing/pull-requests#step-2-make-your-changes) for how to properly format your commit summary and [update](http://eslint.org/docs/developer-guide/contributing/pull-requests#updating-the-commit-message) it on this pull request.")
}

if (payload.pull_request.title.length > 72) {
    problems.push("The pull request title must be 72 characters or shorter. Please check out our [guide](http://eslint.org/docs/developer-guide/contributing/pull-requests#step-2-make-your-changes) for how to properly format your commit summary and [update](http://eslint.org/docs/developer-guide/contributing/pull-requests#updating-the-commit-message) it on this pull request.");
}

// It's only necessary to check the title when the PR is created or the title is edited.
if (
    payload.action !== "opened" &&
    !(payload.action === "edited" && payload.changes.title.from !== payload.pull_request.title)
) {
    // no response
} else if (problems.length) { %>
Thanks for the pull request, @<%= payload.sender.login %>! I took a look to make sure it's ready for merging and found some changes are needed:

<% problems.forEach(function(problem) { %>
* <%- problem %>
<% }); %>

Can you please edit the pull request title to address these?

(More information can be found in our [pull request guide](http://eslint.org/docs/developer-guide/contributing/pull-requests).)

<details>
  <summary>Why is this required?</summary>

  It's important that commit messages have a consistent format, because this allows us to use tooling to save time (e.g. autogenerating organized changelogs from commit messages). When a team member merges your pull request with GitHub's UI, the default commit message for the squashed commits is the title of the pull request. We want the title to have the correct format so that we can minimize errors when merging.
</details>
<% } else { %>
LGTM
<% } %>
